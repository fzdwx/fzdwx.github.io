---
title: "MySQL 事务"
date: "2023-04-29T20:58:59+08:00"
layout: "qa"
tags: [MySQL]
---

## 事务

1. 原子性(Atomicity): 事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用；
2. 一致性(Consistency): 执行事务前后，数据保持一致，例如转账业务中，无论事务是否成功，转账者和收款人的总额应该是不变的；
3. 隔离性(Isolation): 并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的；
4. 持久性(Durability): 一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响

### 脏读

> 读取到未提交的数据

一个事务读取数据并对这个数据进行修改, 这个修改对其他事务是可见的, 即使这个事务还没有被提交.

但这时其他事务读取了当前事务还未提交的数据, 当前事务回滚了, 那么第二个事务读取到的数据就是脏数据.

### 不可重复读

> 同一事务内对同一数据读取的内容不一致

一个事务内多次读取同一数据, 在这个事务还没有结束时,

另一个事务也访问这个数据, 并在第一个事务多次读取的中间,

第二个事务进行修改并提交, 这样就会导致第一个事务读取到的数据和之前读取到的数据不一致.

### 幻读

> 同一事务多次读取时, 发现多了一些原本不存在的数据

一个事务读取了几行数据, 接着另一个事务插入了一些数据, 在随后的查询中, 第一个事务就会发现多了一些原本不存在的数据

## 事务隔离级别

MySQL 的隔离级别基于锁和 MVCC 机制共同实现的. MySQL 默认隔离级别的 可重复读

1. 读未提交(Read Uncommitted): 事务中的修改, 即使没有提交, 对其他事务也是可见的
   - 会导致脏读, 不可重复读, 幻读
2. 读已提交(Read Committed): 允许读取并发事务已经提交的数据
   - 会导致不可重复读, 幻读
3. 可重复读(Repeatable Read): 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改
   - 会导致幻读
4. 串行化(Serializable): 对于同一行记录, 读写都会加锁, 事务串行执行
